# Математическо описание на алгоритъма на Де Кастелжо

## 1. Криви на Безие

Кривите на Безие представляват полиномни параметрични криви, т.е. координатните функции на радиус-вектора на произволна точка от кривата са полиноми на един реален аргумент. Те са фундаментален инструмент в компютърното геометрично моделиране, CAD/CAM системите и анимацията. Дефинират се чрез краен брой контролни точки и позволяват интуитивен контрол върху формата на кривата. По този начин дизайнерът или програмистът може да оформя плавни криви без да задава директно всяка точка от тях.

Крива на Безие от степен \( n \) се дефинира като:

$$
B(t) = \sum_{i=0}^{n} P_i \, b_{i,n}(t), \quad t \in [0,1]
$$

- Pᵢ — контролните точки
- bᵢ,ₙ(t) — базисен полином на Бернщайн от степен n

## 2. Полиноми на Бернщайн

Кривата на Безие се изгражда от базисни функции, наречени полиноми на Бернщайн. Те определят как всяка контролна точка влияе на формата в зависимост от параметъра t. Базисният полином на Бернщайн е даден със следната формула:

$$
b_{i,n}(t) = \binom{n}{i} (1-t)^{n-i} t^i
$$

където биномиалният коефициент се изчислява като:

$$
\binom{n}{i} = \frac{n!}{i!(n-i)!}
$$

Свойства на полиномите на Бернщайн:

- bᵢ,ₙ(t) ≥ 0 за t ∈ [0,1]
- Σᵢ₌₀ⁿ bᵢ,ₙ(t) = 1

Първото свойство означава, че базисните функции са неотрицателни в интервала [0,1]; второто — че те образуват разбитие на единицата. Това гарантира, че кривата лежи в изпъкналата обвивка на контролните точки и поведението ѝ е предсказуемо при промяна на t.

---

## 3. Алгоритъм на De Casteljau

Вместо директно да се използва формулата с полиномите на Бернщайн, на практика често се прилага алгоритъмът на Де Кастелжо. Той е числено стабилен и има ясна геометрична интерпретация: точки от кривата се получават чрез последователна линейна интерполация между контролните точки и междинните резултати. На всяка стъпка се конструира ново ниво от точки, докато не остане една-единствена точка — тя и е търсената точка от кривата. Алгоритъмът на Де Кастелжо изчислява точки от кривата чрез последователна линейна интерполация:

$$
P_i^{(r)}(t) = (1-t) P_i^{(r-1)} + t \, P_{i+1}^{(r-1)}, \quad r=1,2,\dots,n
$$

с начални условия:

$$
P_i^{(0)} = P_i, \quad i=0,1,\dots,n
$$

След n стъпки остава една точка. Tя съвпада с точката на кривата при параметър \( t \):

$$
B(t) = P_0^{(n)}(t)
$$

---

## 4. Производни на крива на Безие

За анализ на кривата — допирателна, скорост, кривина — е необходимо изчисляване на производни. Важно свойство на кривите на Безие е, че първата производна отново е крива на Безие, но с по-ниска степен: производната на крива от степен \( n \) е нова Безиева крива от степен \( n-1 \). Контролните точки на тази производна се изразяват просто чрез разликите между съседните контролни точки на оригиналната крива.

**Контролни точки на производната:**

$$
Q_i = n (P_{i+1} - P_i), \quad i=0,1,\dots,n-1
$$

**Формула за първа производна:**

$$
B'(t) = \sum_{i=0}^{n-1} n (P_{i+1} - P_i) \, b_{i,n-1}(t)
$$

**Пример – квадратична крива (\( n = 2 \))**

Най-простият нетривиален случай е квадратичната крива (парабола) с три контролни точки. За три контролни точки P₀, P₁, P₂ първата производна е линейна Безиева крива — т.е. отсечка, която описва скоростния вектор при движение по параболата.

$$
Q_0 = 2(P_1 - P_0), \quad Q_1 = 2(P_2 - P_1)
$$

$$
B'(t) = (1-t) Q_0 + t Q_1
$$

---

## 5. Производна чрез алгоритъма на De Casteljau

Тъй като производната B′(t) е също крива на Безие с контролни точки \( Q_i \), тя може да се изчисли по същия алгоритъм на Де Кастелжо, приложен върху тези точки. Това дава една и съща изчислителна схема и за позицията, и за скоростния вектор. Производната може да се изчисли чрез прилагане на алгоритъма върху контролни точки \( Q_i \).  
Така алгоритъмът позволява едновременно:
- изчисляване на точка от кривата  
- намиране на допирателната (скоростния вектор)

---

## 6. Ходограф на крива на Безие

Ходографът е геометричната крива, която описва краищата на скоростните вектори, нанесени от общ начало. За крива на Безие това е просто кривата, която параметрично се задава от първата производна B′(t). Ходографът на крива на Безие е кривата, дефинирана от първата ѝ производна:

$$
H(t) = B'(t) = \sum_{i=0}^{n-1} n (P_{i+1} - P_i) \, b_{i,n-1}(t)
$$

Геометричен смисъл:
- Всяка точка на ходографа представлява скоростния вектор на оригиналната крива (при съответно t)  
- Формата на ходографа описва как се променя скоростта при движение по кривата  
- Линейни сегменти в ходографа означават линейна промяна на скоростта; закривени участъци — ускорение или забавяне

---

## 7. Subdivision на крива на Безие

Често е необходимо да се раздели една крива на две части — например за по-прецизно рисуване, за рекурсивна обработка или за проверка на гладкостта. Subdivision (разделяне) разбива кривата на две под-криви при избран параметър \( t \). Забележително е, че междинните точки, получени по време на изпълнение на алгоритъма на Де Кастелжо, са точно контролните точки на двете подкриви. Алгоритъмът на Де Кастелжо дава всички нужни междинни точки.

**Контролни точки на подкривите:**

- **Лява под-крива:**  
P₀, P₀^(1), P₀^(2), …, P₀^(n)

- **Дясна под-крива:**  
P₀^(n), P₁^(n-1), P₂^(n-2), …, Pₙ


**Свойства на полиномите на Бернщайн:**

- bᵢ,ₙ(t) ≥ 0 за t ∈ [0,1]  
- Σᵢ₌₀ⁿ bᵢ,ₙ(t) = 1  
- Pᵢ — контролните точки  
- bᵢ,ₙ(t) — базисен полином на Бернщайн от степен n

---

## 8. Предимства

Алгоритъмът на Де Кастелжо се предпочита пред директното изчисляване по формулата на Бернщайн поради редица предимства:

- **Числова стабилност:** използва само линейна интерполация (събиране и умножение), което намалява грешките от закръгляне при голяма степен n  
- **Рекурсивна природа:** междинните резултати директно дават subdivision — разделяне на кривата на две подкриви  
- **Единна схема:** с един и същ механизъм се изчисляват точка от кривата, допирателната и контролните точки за подкривите  
- **Широко приложение** в компютърната графика, анимация, CAD/CAM и геометрично моделиране